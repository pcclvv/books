



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="笔记">
      
      
      
        <meta name="author" content="流浪地球">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>12. MonogoDB 副本集 - 笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                笔记
              </span>
              <span class="md-header-nav__topic">
                12. MonogoDB 副本集
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/caimengzhi/books/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      caimengzhi/books
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../.." title="笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    笔记
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/caimengzhi/books/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      caimengzhi/books
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-1" type="checkbox" id="nav-1-1">
    
    <label class="md-nav__link" for="nav-1-1">
      工具
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-1">
        工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-1-1" type="checkbox" id="nav-1-1-1">
    
    <label class="md-nav__link" for="nav-1-1-1">
      虚拟环境
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-1-1">
        虚拟环境
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/tools/virtualenv.index/" title="1. virtualenv" class="md-nav__link">
      1. virtualenv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/tools/virtualenvwrapper.index/" title="2. virtualenvwrapper" class="md-nav__link">
      2. virtualenvwrapper
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-1-2" type="checkbox" id="nav-1-1-2">
    
    <label class="md-nav__link" for="nav-1-1-2">
      pip 源
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-1-2">
        pip 源
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/tools/pip.index/" title="1. 清华源" class="md-nav__link">
      1. 清华源
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      库学习
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        库学习
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-1" type="checkbox" id="nav-1-2-1">
    
    <label class="md-nav__link" for="nav-1-2-1">
      1. SQLAlchemy库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-1">
        1. SQLAlchemy库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/1.创建表/" title="1. 创建表" class="md-nav__link">
      1. 创建表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/2.基本操作/" title="2. 基本操作" class="md-nav__link">
      2. 基本操作
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/3.回滚/" title="3. 回滚" class="md-nav__link">
      3. 回滚
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/4.统计分组/" title="4. 统计分组" class="md-nav__link">
      4. 统计分组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/5.外键/" title="5. 外键" class="md-nav__link">
      5. 外键
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/SQLAlchemy/6.关系定义/" title="6. 关系定义" class="md-nav__link">
      6. 关系定义
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-2" type="checkbox" id="nav-1-2-2">
    
    <label class="md-nav__link" for="nav-1-2-2">
      2. YAML库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-2">
        2. YAML库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/yaml/1.yaml语法/" title="1. yaml语法" class="md-nav__link">
      1. yaml语法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/yaml/2.yaml使用/" title="2. yaml使用" class="md-nav__link">
      2. yaml使用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-3" type="checkbox" id="nav-1-2-3">
    
    <label class="md-nav__link" for="nav-1-2-3">
      3. sh库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-3">
        3. sh库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/sh/1.sh/" title="1. sh使用" class="md-nav__link">
      1. sh使用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-4" type="checkbox" id="nav-1-2-4">
    
    <label class="md-nav__link" for="nav-1-2-4">
      4. excel库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-4">
        4. excel库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/execel/1.xlrd_xlwt/" title="1. xlrd_xlwt" class="md-nav__link">
      1. xlrd_xlwt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/execel/2.openpyxl/" title="2. openpyxl" class="md-nav__link">
      2. openpyxl
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-5" type="checkbox" id="nav-1-2-5">
    
    <label class="md-nav__link" for="nav-1-2-5">
      5. 加解密库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-5">
        5. 加解密库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/encryption_decryption/base64/1.base64使用/" title="1. base4" class="md-nav__link">
      1. base4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/encryption_decryption/base64/2.案例/" title="2. 加解密execl表" class="md-nav__link">
      2. 加解密execl表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-6" type="checkbox" id="nav-1-2-6">
    
    <label class="md-nav__link" for="nav-1-2-6">
      6. 邮件库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-6">
        6. 邮件库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/email/smtp/lib_smtp/" title="1. smtp" class="md-nav__link">
      1. smtp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/email/smtp/lib_yagmail/" title="2. yagmail" class="md-nav__link">
      2. yagmail
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-7" type="checkbox" id="nav-1-2-7">
    
    <label class="md-nav__link" for="nav-1-2-7">
      7. wordcloud库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-7">
        7. wordcloud库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/wordcloud/1.wordcloud/" title="1. wordcloud" class="md-nav__link">
      1. wordcloud
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/yield/1.yield/" title="8. yield库" class="md-nav__link">
      8. yield库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-9" type="checkbox" id="nav-1-2-9">
    
    <label class="md-nav__link" for="nav-1-2-9">
      9. Nosql
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-9">
        9. Nosql
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/mongo/mongo.index/" title="1. mongo" class="md-nav__link">
      1. mongo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/memcached/memcached.index/" title="2. memcached" class="md-nav__link">
      2. memcached
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-9-3" type="checkbox" id="nav-1-2-9-3">
    
    <label class="md-nav__link" for="nav-1-2-9-3">
      3. redis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-1-2-9-3">
        3. redis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/redis/redis.index/" title="1. redis" class="md-nav__link">
      1. redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/redis/redis.pipeline/" title="2. redis pipeline" class="md-nav__link">
      2. redis pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/redis/redis.transaction/" title="3. redis transaction" class="md-nav__link">
      3. redis transaction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/redis/redis.pub_sub/" title="4. redis pub_sub" class="md-nav__link">
      4. redis pub_sub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/nosql/redis/redis.sentinel/" title="5. redis sentinel" class="md-nav__link">
      5. redis sentinel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-10" type="checkbox" id="nav-1-2-10">
    
    <label class="md-nav__link" for="nav-1-2-10">
      10. 数据处理库
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-1-2-10">
        10. 数据处理库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-10-1" type="checkbox" id="nav-1-2-10-1">
    
    <label class="md-nav__link" for="nav-1-2-10-1">
      1. numPy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-1-2-10-1">
        1. numPy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/numPy/1.index/" title="1. 介绍" class="md-nav__link">
      1. 介绍
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2-10-2" type="checkbox" id="nav-1-2-10-2">
    
    <label class="md-nav__link" for="nav-1-2-10-2">
      2. pandas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-1-2-10-2">
        2. pandas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/pandas/1.index/" title="1. 介绍" class="md-nav__link">
      1. 介绍
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/uuid/uuid.index/" title="11. uuid" class="md-nav__link">
      11. uuid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/LRU/LRU.index/" title="12. LRU" class="md-nav__link">
      12. LRU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/getpass/getpass.index/" title="13. getpass" class="md-nav__link">
      13. getpass
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/os/os.index/" title="14. os" class="md-nav__link">
      14. os
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/sys/sys.index/" title="15. sys" class="md-nav__link">
      15. sys
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/lib/psutil/psutil.index/" title="16. psutil" class="md-nav__link">
      16. psutil
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      其他
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        其他
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/note/note.extend_append/" title="1. 列表" class="md-nav__link">
      1. 列表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Flask
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Flask
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/flask/flask.index/" title="1. 简介" class="md-nav__link">
      1. 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/flask/flask.config/" title="2. 配置" class="md-nav__link">
      2. 配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/flask/flask.view/" title="3. 路由" class="md-nav__link">
      3. 路由
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/flask/flask.methods/" title="4. 请求方法" class="md-nav__link">
      4. 请求方法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/flask/flask.jinja2/" title="5. 模板" class="md-nav__link">
      5. 模板
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Django
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Django
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      知识点
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        知识点
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/note/django.blank/" title="1. 表单空" class="md-nav__link">
      1. 表单空
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      组件
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        组件
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/note/django.url_name/" title="1. name" class="md-nav__link">
      1. name
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/note/django.duplication_url_name/" title="2. 重名url" class="md-nav__link">
      2. 重名url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/url/django.reverse_url/" title="3. url 反向解析" class="md-nav__link">
      3. url 反向解析
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/url/django.paginator/" title="4. 分页器" class="md-nav__link">
      4. 分页器
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/form/django.form/" title="5. 表单" class="md-nav__link">
      5. 表单
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../python/django/middleware/django.middleware/" title="6. 中间件" class="md-nav__link">
      6. 中间件
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Hadoop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Hadoop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      CDH
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        CDH
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.index/" title="1. CDH 介绍" class="md-nav__link">
      1. CDH 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.deploy/" title="2. CDH 部署" class="md-nav__link">
      2. CDH 部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.namenode_ha/" title="3. NameNode HA" class="md-nav__link">
      3. NameNode HA
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      HDFS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        HDFS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.hdfs_info/" title="1. HDFS 介绍" class="md-nav__link">
      1. HDFS 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.hdfs_shell/" title="2. HDFS shell" class="md-nav__link">
      2. HDFS shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.secondary_namenode/" title="3. secondary_namenode" class="md-nav__link">
      3. secondary_namenode
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Hive
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Hive
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../hadoop/CDH/cdh.hive/" title="1. Hive 介绍" class="md-nav__link">
      1. Hive 介绍
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      DStorage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        DStorage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../distributed_storage/distributed_storage.info/" title="对比" class="md-nav__link">
      对比
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Linux
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../url/url.index/" title="url" class="md-nav__link">
      url
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      raid
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        raid
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../raid/raid.index/" title="1. raid 介绍" class="md-nav__link">
      1. raid 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../raid/raid.card/" title="2. raid 实战" class="md-nav__link">
      2. raid 实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      小工具
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        小工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/elinks/elinks.index/" title="1. elinks" class="md-nav__link">
      1. elinks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/script_scriptreplay/1.index/" title="2. Linux终端录屏和回放" class="md-nav__link">
      2. Linux终端录屏和回放
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3-3" type="checkbox" id="nav-6-3-3">
    
    <label class="md-nav__link" for="nav-6-3-3">
      3. xshell
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-3-3">
        3. xshell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/xshell/xshell.index/" title="1. xshell迁移数据" class="md-nav__link">
      1. xshell迁移数据
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/xshell/xshell.silent/" title="2. xshell无声配置" class="md-nav__link">
      2. xshell无声配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3-4" type="checkbox" id="nav-6-3-4">
    
    <label class="md-nav__link" for="nav-6-3-4">
      4. 下载
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-3-4">
        4. 下载
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/axel.index/" title="1. axel" class="md-nav__link">
      1. axel
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3-5" type="checkbox" id="nav-6-3-5">
    
    <label class="md-nav__link" for="nav-6-3-5">
      5. NodePad
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-3-5">
        5. NodePad
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/nodepad/nodepad.nppftp/" title="1. NppFTP" class="md-nav__link">
      1. NppFTP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3-6" type="checkbox" id="nav-6-3-6">
    
    <label class="md-nav__link" for="nav-6-3-6">
      6. 自动化工具
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-3-6">
        6. 自动化工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/sshpass/sshpass.index/" title="1. sshpass" class="md-nav__link">
      1. sshpass
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/pssh/pssh.index/" title="2. pssh" class="md-nav__link">
      2. pssh
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      服务
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/harbor/harbor.index/" title="1. Harbor" class="md-nav__link">
      1. Harbor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/pppoe/pppoe.index/" title="2. PPPOE" class="md-nav__link">
      2. PPPOE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/deploy_django/deploy_django.index/" title="3. django项目部署" class="md-nav__link">
      3. django项目部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/sersync/sersync/" title="4. sersync" class="md-nav__link">
      4. sersync
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      证书
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        证书
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/certificate/tomcat.index/" title="1. Tomcat" class="md-nav__link">
      1. Tomcat
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6" type="checkbox" id="nav-6-6">
    
    <label class="md-nav__link" for="nav-6-6">
      shell脚本
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-6">
        shell脚本
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../shell/system/linux.system_check/" title="1. 系统巡检" class="md-nav__link">
      1. 系统巡检
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../shell/system/linux.network/" title="2. 网卡信息" class="md-nav__link">
      2. 网卡信息
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-6-3" type="checkbox" id="nav-6-6-3">
    
    <label class="md-nav__link" for="nav-6-6-3">
      3. mysql
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-6-6-3">
        3. mysql
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../shell/mysql/install/mysql.install/" title="1. 安装" class="md-nav__link">
      1. 安装
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Nginx
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Nginx
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.index/" title="01. nginx 部署" class="md-nav__link">
      01. nginx 部署
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.conf/" title="02. nginx 配置文件" class="md-nav__link">
      02. nginx 配置文件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.virtual_hosts/" title="03. nginx 虚拟主机" class="md-nav__link">
      03. nginx 虚拟主机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.log/" title="04. nginx 日志" class="md-nav__link">
      04. nginx 日志
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.nti_theft_chain/" title="05. nginx 防盗链" class="md-nav__link">
      05. nginx 防盗链
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.other/" title="06. nginx 常见配置" class="md-nav__link">
      06. nginx 常见配置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.optimization/" title="07. nginx 优化" class="md-nav__link">
      07. nginx 优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.hash/" title="08. nginx hash" class="md-nav__link">
      08. nginx hash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.location/" title="09. nginx location" class="md-nav__link">
      09. nginx location
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.rewrite/" title="10. nginx rewrite" class="md-nav__link">
      10. nginx rewrite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.slb/" title="11. nginx 负载均衡" class="md-nav__link">
      11. nginx 负载均衡
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../nginx/nginx.http2/" title="12. nginx http2" class="md-nav__link">
      12. nginx http2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" checked>
    
    <label class="md-nav__link" for="nav-8">
      Nosql
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Nosql
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1" checked>
    
    <label class="md-nav__link" for="nav-8-1">
      1. MonogoDB
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        1. MonogoDB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.index/" title="01. MonogoDB 介绍" class="md-nav__link">
      01. MonogoDB 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.databases/" title="02. MonogoDB 数据库" class="md-nav__link">
      02. MonogoDB 数据库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.collection/" title="03. MonogoDB 集合" class="md-nav__link">
      03. MonogoDB 集合
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.doc/" title="04. MonogoDB 文档" class="md-nav__link">
      04. MonogoDB 文档
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.conditional_query/" title="05. MonogoDB 条件查询" class="md-nav__link">
      05. MonogoDB 条件查询
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.fuzzy_enquiry/" title="06. MonogoDB 模糊查询" class="md-nav__link">
      06. MonogoDB 模糊查询
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.type/" title="07. MonogoDB $type" class="md-nav__link">
      07. MonogoDB $type
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.limit_skip/" title="08. MonogoDB LS" class="md-nav__link">
      08. MonogoDB LS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.sort/" title="09. MonogoDB 排序" class="md-nav__link">
      09. MonogoDB 排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.backup_recovery/" title="10. MonogoDB 备份与恢复" class="md-nav__link">
      10. MonogoDB 备份与恢复
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.monitor/" title="11. MonogoDB 监控" class="md-nav__link">
      11. MonogoDB 监控
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        12. MonogoDB 副本集
      </label>
    
    <a href="./" title="12. MonogoDB 副本集" class="md-nav__link md-nav__link--active">
      12. MonogoDB 副本集
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" title="1. 介绍" class="md-nav__link">
    1. 介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" title="2. 原理" class="md-nav__link">
    2. 原理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" title="2.1 自动切换" class="md-nav__link">
    2.1 自动切换
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" title="3. 部署搭建" class="md-nav__link">
    3. 部署搭建
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" title="3.1 环境准备" class="md-nav__link">
    3.1 环境准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" title="3.2 安装" class="md-nav__link">
    3.2 安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" title="3.3 配置" class="md-nav__link">
    3.3 配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" title="3.3.1 配置文件" class="md-nav__link">
    3.3.1 配置文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" title="3.3.2 初始化" class="md-nav__link">
    3.3.2 初始化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" title="3.3.3 其他命令" class="md-nav__link">
    3.3.3 其他命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" title="3.4 测试" class="md-nav__link">
    3.4 测试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341" title="3.4.1 简单测试" class="md-nav__link">
    3.4.1 简单测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" title="3.4.3 副本测试" class="md-nav__link">
    3.4.3 副本测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343_1" title="3.4.3 高可用测试" class="md-nav__link">
    3.4.3 高可用测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" title="4. 其他测试" class="md-nav__link">
    4. 其他测试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" title="4.1 删除" class="md-nav__link">
    4.1 删除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" title="4.2 添加" class="md-nav__link">
    4.2 添加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" title="4.3 查看复制的情况" class="md-nav__link">
    4.3 查看复制的情况
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" title="4.4 查看副本集配置" class="md-nav__link">
    4.4 查看副本集配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" title="4.5 注意" class="md-nav__link">
    4.5 注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" title="5. 应用" class="md-nav__link">
    5. 应用
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" title="5.1 手动切换" class="md-nav__link">
    5.1 手动切换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" title="5.2 添加备份节点" class="md-nav__link">
    5.2 添加备份节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" title="5.3 添加延时节点" class="md-nav__link">
    5.3 添加延时节点
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" title="5.3.1 操作" class="md-nav__link">
    5.3.1 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532" title="5.3.2 测试" class="md-nav__link">
    5.3.2 测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" title="5.4 读写分离" class="md-nav__link">
    5.4 读写分离
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.shard_info/" title="13. MonogoDB 分片集" class="md-nav__link">
      13. MonogoDB 分片集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mongo.shard_replicat/" title="14. MonogoDB 分片集实战" class="md-nav__link">
      14. MonogoDB 分片集实战
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      2. redis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        2. redis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.index/" title="01. redis 介绍" class="md-nav__link">
      01. redis 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.install/" title="02. redis 安装" class="md-nav__link">
      02. redis 安装
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.auth/" title="03. redis 认证" class="md-nav__link">
      03. redis 认证
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.k_v/" title="04. redis 键值对" class="md-nav__link">
      04. redis 键值对
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.publish/" title="05. redis 发布订阅" class="md-nav__link">
      05. redis 发布订阅
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.arrairs/" title="06. redis 事务" class="md-nav__link">
      06. redis 事务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.store/" title="07. redis 持久化存储" class="md-nav__link">
      07. redis 持久化存储
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.save/" title="08. redis 备份与恢复" class="md-nav__link">
      08. redis 备份与恢复
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.sentinel_cluster/" title="09. redis 集群" class="md-nav__link">
      09. redis 集群
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.master-slave/" title="10. redis 主从" class="md-nav__link">
      10. redis 主从
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.sentinel/" title="11. redis 哨兵" class="md-nav__link">
      11. redis 哨兵
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.cluster/" title="12. redis cluster" class="md-nav__link">
      12. redis cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.cache_policy/" title="13. redis 缓存策略" class="md-nav__link">
      13. redis 缓存策略
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.breakdown/" title="14. redis 击穿" class="md-nav__link">
      14. redis 击穿
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../redis/redis.avalanche/" title="15. redis 雪崩" class="md-nav__link">
      15. redis 雪崩
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      3. memcached
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        3. memcached
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../memcached/memcached.index/" title="1. memcached" class="md-nav__link">
      1. memcached
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      mysql
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        mysql
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-1" type="checkbox" id="nav-9-1">
    
    <label class="md-nav__link" for="nav-9-1">
      1. MySQL 基础
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-1">
        1. MySQL 基础
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.index/" title="01. MySQL 介绍" class="md-nav__link">
      01. MySQL 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.info/" title="02. MySQL 初识" class="md-nav__link">
      02. MySQL 初识
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.conn/" title="03. MySQL 链接" class="md-nav__link">
      03. MySQL 链接
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.database/" title="04. MySQL 库" class="md-nav__link">
      04. MySQL 库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.table/" title="05. MySQL 表" class="md-nav__link">
      05. MySQL 表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.select/" title="06. SQL SELECT" class="md-nav__link">
      06. SQL SELECT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.where/" title="07. SQL WHERE" class="md-nav__link">
      07. SQL WHERE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.update/" title="08. SQL UPDATE" class="md-nav__link">
      08. SQL UPDATE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.delete/" title="09. SQL DELETE" class="md-nav__link">
      09. SQL DELETE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.like/" title="10. SQL LIKE" class="md-nav__link">
      10. SQL LIKE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.distinct/" title="11. SQL DISTINCT" class="md-nav__link">
      11. SQL DISTINCT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.limit/" title="12. SQL LIMIT" class="md-nav__link">
      12. SQL LIMIT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.and_or/" title="13. SQL AND_OR" class="md-nav__link">
      13. SQL AND_OR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.orderby/" title="14. SQL ORDER" class="md-nav__link">
      14. SQL ORDER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.insert/" title="15. SQL INSERT" class="md-nav__link">
      15. SQL INSERT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.desc/" title="16. SQL DESC" class="md-nav__link">
      16. SQL DESC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.in/" title="17. SQL IN" class="md-nav__link">
      17. SQL IN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.between/" title="18. SQL BETWEEN" class="md-nav__link">
      18. SQL BETWEEN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.alias/" title="19. SQL ALIAS" class="md-nav__link">
      19. SQL ALIAS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.grant/" title="20. SQL GRANT" class="md-nav__link">
      20. SQL GRANT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.alter/" title="21. SQL ALTER" class="md-nav__link">
      21. SQL ALTER
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2">
    
    <label class="md-nav__link" for="nav-9-2">
      2. MySQL 进阶
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        2. MySQL 进阶
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.pk/" title="1. SQL PK" class="md-nav__link">
      1. SQL PK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.increment/" title="2. SQL INCREMENT" class="md-nav__link">
      2. SQL INCREMENT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.transaction/" title="3. SQL 事务" class="md-nav__link">
      3. SQL 事务
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.null/" title="4. NULL" class="md-nav__link">
      4. NULL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.regexp/" title="5. 正则" class="md-nav__link">
      5. 正则
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.multi_table_query/" title="6. 多表查询" class="md-nav__link">
      6. 多表查询
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-3" type="checkbox" id="nav-9-3">
    
    <label class="md-nav__link" for="nav-9-3">
      3. MySQL 容灾
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-3">
        3. MySQL 容灾
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.mysqldump/" title="1. mysqldump 参数" class="md-nav__link">
      1. mysqldump 参数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.mysqldump_case/" title="2. mysqldump 脚本" class="md-nav__link">
      2. mysqldump 脚本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../server/xtrabackup/xtrabackup.index/" title="3. xtrabackup" class="md-nav__link">
      3. xtrabackup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.restore_data/" title="4. binlog 恢复数据" class="md-nav__link">
      4. binlog 恢复数据
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-4" type="checkbox" id="nav-9-4">
    
    <label class="md-nav__link" for="nav-9-4">
      4. MySQL 复制
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-4">
        4. MySQL 复制
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.master-slave/" title="1. 主从" class="md-nav__link">
      1. 主从
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.master-master/" title="2. 主主" class="md-nav__link">
      2. 主主
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9-5" type="checkbox" id="nav-9-5">
    
    <label class="md-nav__link" for="nav-9-5">
      5. MySQL OTHER
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-9-5">
        5. MySQL OTHER
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.practice1/" title="01. MySQL练习" class="md-nav__link">
      01. MySQL练习
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.mysqlcnf/" title="02. 配置文件" class="md-nav__link">
      02. 配置文件
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.increment_offset/" title="03. 自增/偏移量" class="md-nav__link">
      03. 自增/偏移量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.delete_truncate_drop/" title="04. 表删除" class="md-nav__link">
      04. 表删除
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.binlog/" title="05. binlog 介绍" class="md-nav__link">
      05. binlog 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.integrity_constraint/" title="06. 完整性约束" class="md-nav__link">
      06. 完整性约束
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.copy_table/" title="07. 表复制" class="md-nav__link">
      07. 表复制
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.storage_engine/" title="08. 存储引擎" class="md-nav__link">
      08. 存储引擎
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.user/" title="09. 用户" class="md-nav__link">
      09. 用户
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../mysql/mysql.affairs/" title="10. 事务" class="md-nav__link">
      10. 事务
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      前端
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../frontend/vue/" title="Vue" class="md-nav__link">
      Vue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../frontend/css/css.index/" title="CSS" class="md-nav__link">
      CSS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      服务
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11-1" type="checkbox" id="nav-11-1">
    
    <label class="md-nav__link" for="nav-11-1">
      1. git
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-11-1">
        1. git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.index/" title="1. git 介绍" class="md-nav__link">
      1. git 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.rollback/" title="2. git 回滚" class="md-nav__link">
      2. git 回滚
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.branch/" title="3. git 分支" class="md-nav__link">
      3. git 分支
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.label/" title="4. git 标签" class="md-nav__link">
      4. git 标签
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.standard/" title="5. git 分支管理" class="md-nav__link">
      5. git 分支管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/git/git.gui/" title="6. git GUI" class="md-nav__link">
      6. git GUI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/github/github.index/" title="2. github" class="md-nav__link">
      2. github
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11-3" type="checkbox" id="nav-11-3">
    
    <label class="md-nav__link" for="nav-11-3">
      3. gitlab
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-11-3">
        3. gitlab
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/gitlab/gitlab.index/" title="1. gitlab" class="md-nav__link">
      1. gitlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/gitlab/gitlab.close_register/" title="2. 关闭注册" class="md-nav__link">
      2. 关闭注册
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../tools/gitlab/gitlab.set_root_pwd/" title="3. 找回root密码" class="md-nav__link">
      3. 找回root密码
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      教程
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        教程
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../course/" title="教程" class="md-nav__link">
      教程
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      测试
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        测试
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1" type="checkbox" id="nav-13-1">
    
    <label class="md-nav__link" for="nav-13-1">
      服务
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-13-1">
        服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1" type="checkbox" id="nav-13-1-1">
    
    <label class="md-nav__link" for="nav-13-1-1">
      mkdocs 服务
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-13-1-1">
        mkdocs 服务
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../.." title="一. 介绍" class="md-nav__link">
      一. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-2" type="checkbox" id="nav-13-1-1-2">
    
    <label class="md-nav__link" for="nav-13-1-1-2">
      二. 安装
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-13-1-1-2">
        二. 安装
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../install/local/" title="1. 本地环境搭建" class="md-nav__link">
      1. 本地环境搭建
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../install/github-pages/" title="2. 发布至GitHub Pages" class="md-nav__link">
      2. 发布至GitHub Pages
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../install/http-server/" title="3. 发布至自己的HTTP Server" class="md-nav__link">
      3. 发布至自己的HTTP Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3" type="checkbox" id="nav-13-1-1-3">
    
    <label class="md-nav__link" for="nav-13-1-1-3">
      三. 语法
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-13-1-1-3">
        三. 语法
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/main/" title="1. 语法总览" class="md-nav__link">
      1. 语法总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/headline/" title="2. 标题" class="md-nav__link">
      2. 标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/paragraph/" title="3. 段落" class="md-nav__link">
      3. 段落
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/quote/" title="4. 引用" class="md-nav__link">
      4. 引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/table/" title="5. 表格" class="md-nav__link">
      5. 表格
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-6" type="checkbox" id="nav-13-1-1-3-6">
    
    <label class="md-nav__link" for="nav-13-1-1-3-6">
      6. 代码
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-6">
        6. 代码
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/code_inline/" title="6.1. 行内" class="md-nav__link">
      6.1. 行内
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/code_block/" title="6.2. 区块" class="md-nav__link">
      6.2. 区块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/code_highlight/" title="6.3. 高亮" class="md-nav__link">
      6.3. 高亮
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-7" type="checkbox" id="nav-13-1-1-3-7">
    
    <label class="md-nav__link" for="nav-13-1-1-3-7">
      7. 字体样式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-7">
        7. 字体样式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/font_stress/" title="7.1. 斜体,粗体,粗斜体" class="md-nav__link">
      7.1. 斜体,粗体,粗斜体
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/font_updown/" title="7.2. 上标,下标" class="md-nav__link">
      7.2. 上标,下标
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/font_underline/" title="7.3. 下划线" class="md-nav__link">
      7.3. 下划线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/font_line/" title="7.4. 横线" class="md-nav__link">
      7.4. 横线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/font_underline_line/" title="7.5. 下划线+横线" class="md-nav__link">
      7.5. 下划线+横线
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-8" type="checkbox" id="nav-13-1-1-3-8">
    
    <label class="md-nav__link" for="nav-13-1-1-3-8">
      8. 列表
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-8">
        8. 列表
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/list_noseq/" title="8.1. 无序列表" class="md-nav__link">
      8.1. 无序列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/list_seq/" title="8.2. 有序列表" class="md-nav__link">
      8.2. 有序列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/list_task/" title="8.3. 任务列表" class="md-nav__link">
      8.3. 任务列表
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/cutline/" title="9. 分割线" class="md-nav__link">
      9. 分割线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-10" type="checkbox" id="nav-13-1-1-3-10">
    
    <label class="md-nav__link" for="nav-13-1-1-3-10">
      10. 链接
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-10">
        10. 链接
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/link_normal/" title="10.1. 普通链接" class="md-nav__link">
      10.1. 普通链接
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/link_auto/" title="10.2. 自动链接" class="md-nav__link">
      10.2. 自动链接
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/link_anchor/" title="10.3. 锚点提示" class="md-nav__link">
      10.3. 锚点提示
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-11" type="checkbox" id="nav-13-1-1-3-11">
    
    <label class="md-nav__link" for="nav-13-1-1-3-11">
      11. 图片
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-11">
        11. 图片
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/image_inline/" title="11.1. 行内式" class="md-nav__link">
      11.1. 行内式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/image_index/" title="11.2. 参考式" class="md-nav__link">
      11.2. 参考式
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/escape/" title="12. 转义" class="md-nav__link">
      12. 转义
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-13" type="checkbox" id="nav-13-1-1-3-13">
    
    <label class="md-nav__link" for="nav-13-1-1-3-13">
      13. 高亮
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-13">
        13. 高亮
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/highlight_code/" title="13.1. 代码高亮" class="md-nav__link">
      13.1. 代码高亮
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/highlight_background/" title="13.2. 背景高亮" class="md-nav__link">
      13.2. 背景高亮
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-14" type="checkbox" id="nav-13-1-1-3-14">
    
    <label class="md-nav__link" for="nav-13-1-1-3-14">
      14. 注解
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-14">
        14. 注解
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_main/" title="14.1. 介绍" class="md-nav__link">
      14.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_full/" title="14.2. 完整格式" class="md-nav__link">
      14.2. 完整格式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_empty-title/" title="14.3. 空标题" class="md-nav__link">
      14.3. 空标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_none-title/" title="14.4. 无标题" class="md-nav__link">
      14.4. 无标题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_none-type/" title="14.5. 无类型" class="md-nav__link">
      14.5. 无类型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_details/" title="14.6. 折叠" class="md-nav__link">
      14.6. 折叠
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_style/" title="14.7. 11种颜色样式" class="md-nav__link">
      14.7. 11种颜色样式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/note_nest/" title="14.8. 嵌套" class="md-nav__link">
      14.8. 嵌套
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/footnote/" title="15. 脚注" class="md-nav__link">
      15. 脚注
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/meta/" title="16. 元信息" class="md-nav__link">
      16. 元信息
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-17" type="checkbox" id="nav-13-1-1-3-17">
    
    <label class="md-nav__link" for="nav-13-1-1-3-17">
      17. 数学公式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-17">
        17. 数学公式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/math_main/" title="17.1. 介绍" class="md-nav__link">
      17.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/math_js/" title="17.2. 导入js" class="md-nav__link">
      17.2. 导入js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/math_usage/" title="17.3. 用法" class="md-nav__link">
      17.3. 用法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-18" type="checkbox" id="nav-13-1-1-3-18">
    
    <label class="md-nav__link" for="nav-13-1-1-3-18">
      18. emoji
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-18">
        18. emoji
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/emoji_main/" title="18.1. 介绍" class="md-nav__link">
      18.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/emoji_principle/" title="18.2. 工作原理" class="md-nav__link">
      18.2. 工作原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/emoji_usage/" title="18.3. 最佳实践" class="md-nav__link">
      18.3. 最佳实践
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/symbol/" title="19. 特殊符号" class="md-nav__link">
      19. 特殊符号
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-3-20" type="checkbox" id="nav-13-1-1-3-20">
    
    <label class="md-nav__link" for="nav-13-1-1-3-20">
      20. 嵌套
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="5">
      <label class="md-nav__title" for="nav-13-1-1-3-20">
        20. 嵌套
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_main/" title="20.1. 介绍" class="md-nav__link">
      20.1. 介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_note_note/" title="20.2. 注解-注解" class="md-nav__link">
      20.2. 注解-注解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_list_list/" title="20.3. 列表-列表" class="md-nav__link">
      20.3. 列表-列表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_quote_quote/" title="20.4. 引用-引用" class="md-nav__link">
      20.4. 引用-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_note_code/" title="20.5. 注解-代码块" class="md-nav__link">
      20.5. 注解-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_list_code/" title="20.6. 列表-代码块" class="md-nav__link">
      20.6. 列表-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_quote_code/" title="20.7. 引用-代码块" class="md-nav__link">
      20.7. 引用-代码块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_yellow_code/" title="20.8. 黄色区块-代码" class="md-nav__link">
      20.8. 黄色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_green_code/" title="20.9. 绿色区块-代码" class="md-nav__link">
      20.9. 绿色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_red_code/" title="20.10. 红色区块-代码" class="md-nav__link">
      20.10. 红色区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_greenred_code/" title="20.11. 绿接红区块-代码" class="md-nav__link">
      20.11. 绿接红区块-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_note_list_quote/" title="20.12. 注解-列表-引用" class="md-nav__link">
      20.12. 注解-列表-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_list_list_quote/" title="20.13. 列表-列表-引用" class="md-nav__link">
      20.13. 列表-列表-引用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../syntax/nest_quote_quote_code/" title="20.14. 引用-引用-代码" class="md-nav__link">
      20.14. 引用-引用-代码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../resume/" title="20.15. 简历" class="md-nav__link">
      20.15. 简历
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13-1-1-4" type="checkbox" id="nav-13-1-1-4">
    
    <label class="md-nav__link" for="nav-13-1-1-4">
      四. 附录
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="4">
      <label class="md-nav__title" for="nav-13-1-1-4">
        四. 附录
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/pygments/" title="1. 支持代码高亮的语言" class="md-nav__link">
      1. 支持代码高亮的语言
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/emoji_shortname/" title="2. emojione全名短名映射表" class="md-nav__link">
      2. emojione全名短名映射表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/baidu_tongji/" title="3. 添加百度统计" class="md-nav__link">
      3. 添加百度统计
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/color/" title="4. 配色" class="md-nav__link">
      4. 配色
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/module/" title="5. 模块介绍" class="md-nav__link">
      5. 模块介绍
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/level/" title="6. mkdocs层级关系" class="md-nav__link">
      6. mkdocs层级关系
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/search/" title="7. 支持中文搜索" class="md-nav__link">
      7. 支持中文搜索
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../appendix/yml/" title="8. mkdocs.yml范例" class="md-nav__link">
      8. mkdocs.yml范例
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../recommend/" title="五. 使用建议" class="md-nav__link">
      五. 使用建议
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../contact/" title="六. 联系方式" class="md-nav__link">
      六. 联系方式
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" title="1. 介绍" class="md-nav__link">
    1. 介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" title="2. 原理" class="md-nav__link">
    2. 原理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" title="2.1 自动切换" class="md-nav__link">
    2.1 自动切换
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" title="3. 部署搭建" class="md-nav__link">
    3. 部署搭建
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" title="3.1 环境准备" class="md-nav__link">
    3.1 环境准备
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" title="3.2 安装" class="md-nav__link">
    3.2 安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" title="3.3 配置" class="md-nav__link">
    3.3 配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#331" title="3.3.1 配置文件" class="md-nav__link">
    3.3.1 配置文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#332" title="3.3.2 初始化" class="md-nav__link">
    3.3.2 初始化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#333" title="3.3.3 其他命令" class="md-nav__link">
    3.3.3 其他命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" title="3.4 测试" class="md-nav__link">
    3.4 测试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#341" title="3.4.1 简单测试" class="md-nav__link">
    3.4.1 简单测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343" title="3.4.3 副本测试" class="md-nav__link">
    3.4.3 副本测试
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#343_1" title="3.4.3 高可用测试" class="md-nav__link">
    3.4.3 高可用测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" title="4. 其他测试" class="md-nav__link">
    4. 其他测试
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" title="4.1 删除" class="md-nav__link">
    4.1 删除
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" title="4.2 添加" class="md-nav__link">
    4.2 添加
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" title="4.3 查看复制的情况" class="md-nav__link">
    4.3 查看复制的情况
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" title="4.4 查看副本集配置" class="md-nav__link">
    4.4 查看副本集配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45" title="4.5 注意" class="md-nav__link">
    4.5 注意
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" title="5. 应用" class="md-nav__link">
    5. 应用
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51" title="5.1 手动切换" class="md-nav__link">
    5.1 手动切换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52" title="5.2 添加备份节点" class="md-nav__link">
    5.2 添加备份节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" title="5.3 添加延时节点" class="md-nav__link">
    5.3 添加延时节点
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#531" title="5.3.1 操作" class="md-nav__link">
    5.3.1 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#532" title="5.3.2 测试" class="md-nav__link">
    5.3.2 测试
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54" title="5.4 读写分离" class="md-nav__link">
    5.4 读写分离
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/caimengzhi/books/edit/master/docs/linux/nosql/mongo/mongo.replication.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <p><center><h1>mongod副本集</h1></center></p>
<h2 id="1">1. 介绍<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>&#160; &#160; &#160; &#160;MongoDB 副本集（Replica Set）是有自动故障恢复功能的主从集群，有一个Primary节点和一个或多个Secondary节点组成。类似于MySQL的MMM架构。更多关于副本集的介绍请见<a href="https://docs.mongodb.com/manual/replication/">官网</a>。也可以在google、baidu上查阅。mongodb是一款优秀的nosql软件。因为起点晚，吸取了前辈们的优点，</p>
<h2 id="2">2. 原理<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>&#160; &#160; &#160; &#160;副本集中数据同步过程：Primary节点写入数据，Secondary通过读取Primary的oplog得到复制信息，开始复制数据并且将复制信息写入到自己的oplog。如果某个操作失败，则备份节点停止从当前数据源复制数据。如果某个备份节点由于某些原因挂掉了，当重新启动后，就会自动从oplog的最后一个操作开始同步，同步完成后，将信息写入自己的oplog，由于复制操作是先复制数据，复制完成后再写入oplog，有可能相同的操作会同步两份，不过MongoDB在设计之初就考虑到这个问题，将oplog的同一个操作执行多次，与执行一次的效果是一样的。简单的说就是：</p>
<p>当Primary节点完成数据操作后，Secondary会做出一系列的动作保证数据的同步</p>
<ul>
<li>1：检查自己local库的oplog.rs集合找出最近的时间戳。</li>
<li>2：检查Primary节点local库oplog.rs集合，找出大于此时间戳的记录。</li>
<li>3：将找到的记录插入到自己的oplog.rs集合中，并执行这些操作。</li>
</ul>
<p>&#160; &#160; &#160; &#160;副本集的同步和主从同步一样，都是异步同步的过程，不同的是副本集有个自动故障转移的功能。其原理是：slave端从primary端获取日志，然后在自己身上完全顺序的执行日志所记录的各种操作（该日志是不记录查询操作的），这个日志就是local数据 库中的oplog.rs表，默认在64位机器上这个表是比较大的，占磁盘大小的5%，oplog.rs的大小可以在启动参数中设 定：--oplogSize 1000,单位是M。</p>
<blockquote>
<p>注意：在副本集的环境中，要是所有的Secondary都宕机了，只剩下Primary。最后Primary会变成Secondary，不能提供服务。</p>
</blockquote>
<h3 id="21">2.1 自动切换<a class="headerlink" href="#21" title="Permanent link">&para;</a></h3>
<p>集群开始，如下</p>
<p><img alt="demo" src="../../../../pictures/linux/nosql/mongo/p2.png" /></p>
<p><img alt="primary正常工作" src="../../../../pictures/linux/nosql/mongo/p3.png" /></p>
<p>primary挂了以后</p>
<p><img alt="primary挂了以后" src="../../../../pictures/linux/nosql/mongo/p4.png" /></p>
<h2 id="3">3. 部署搭建<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31">3.1 环境准备<a class="headerlink" href="#31" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>IP</th>
<th>主机名</th>
<th>系统</th>
<th>安装软件</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.178.128</td>
<td>node3</td>
<td>ubuntu16</td>
<td>mongodb</td>
</tr>
<tr>
<td>192.168.178.129</td>
<td>node2</td>
<td>ubuntu16</td>
<td>mongodb</td>
</tr>
<tr>
<td>192.168.178.130</td>
<td>node1</td>
<td>ubuntu16</td>
<td>mongodb</td>
</tr>
</tbody>
</table>
<h3 id="32">3.2 安装<a class="headerlink" href="#32" title="Permanent link">&para;</a></h3>
<p><a href="https://www.mongodb.com/download-center/community">官网包</a></p>
<p><a href="https://caimengzhi.github.io/books/linux/nosql/mongo/mongo.index/">离线安装文档</a></p>
<p><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">在线安装文档</a></p>
<p>安装
<div class="codehilite"><pre><span></span>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org
systemctl start mongod.service
cp /etc/mongod.conf /etc/mongod.conf.ori
sed -i &#39;s/bindIp: 127.0.0.1/bindIp: 0.0.0.0/&#39; /etc/mongod.conf
grep -i &#39;bindIp&#39; /etc/mongod.conf
systemctl start mongod.service
</pre></div>
卸载</p>
<div class="codehilite"><pre><span></span>sudo service mongod stop
sudo apt-get purge mongodb-org*
sudo rm -r /var/log/mongodb
sudo rm -r /var/lib/mongodb
</pre></div>

<p>安装过程</p>
<p><div class="codehilite"><pre><span></span>root@node1:~# sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4
Executing: /tmp/tmp.KG9f1TH9ct/gpg.1.sh --keyserver
hkp://keyserver.ubuntu.com:80
--recv
9DA31620334BD75D9DCB49F368818C72E52529D4
gpg: requesting key E52529D4 from hkp server keyserver.ubuntu.com
gpg: key E52529D4: public key &quot;MongoDB 4.0 Release Signing Key &lt;packaging@mongodb.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)

root@node1:~# echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list
deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.0 multiverse

root@node1:~# sudo apt-get install -y mongodb-org
Reading package lists... Done
........

root@node1:~# systemctl start mongod.service
Display all 159 possibilities? (y or n)
root@node1:~# systemctl start mongod.service
root@node1:~# systemctl status mongod.service
● mongod.service - MongoDB Database Server
   Loaded: loaded (/lib/systemd/system/mongod.service; disabled; vendor preset: enabled)
   Active: active (running) since Wed 2019-04-03 09:56:57 CST; 6s ago
     Docs: https://docs.mongodb.org/manual
 Main PID: 3301 (mongod)
   CGroup: /system.slice/mongod.service
           └─3301 /usr/bin/mongod --config /etc/mongod.conf

Apr 03 09:56:57 node1 systemd[1]: Started MongoDB Database Server.


root@node1:~# mongo
MongoDB shell version v4.0.6
connecting to: mongodb://127.0.0.1:27017/?gssapiServiceName=mongodb
Implicit session: session { &quot;id&quot; : UUID(&quot;acf7e437-8b69-4892-8e8c-cba85de600a0&quot;) }
MongoDB server version: 4.0.8
Welcome to the MongoDB shell.
For interactive help, type &quot;help&quot;.
For more comprehensive documentation, see
    http://docs.mongodb.org/
Questions? Try the support group
    http://groups.google.com/group/mongodb-user
Server has startup warnings:
2019-04-02T18:56:57.640-0700 I STORAGE  [initandlisten]
2019-04-02T18:56:57.640-0700 I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine
2019-04-02T18:56:57.640-0700 I STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem
2019-04-02T18:56:58.353-0700 I CONTROL  [initandlisten]
2019-04-02T18:56:58.353-0700 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.
2019-04-02T18:56:58.353-0700 I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.
2019-04-02T18:56:58.353-0700 I CONTROL  [initandlisten]
---
Enable MongoDB&#39;s free cloud-based monitoring service, which will then receive and display
metrics about your deployment (disk utilization, CPU, operation statistics, etc).

The monitoring data will be available on a MongoDB website with a unique URL accessible to you
and anyone you share the URL with. MongoDB may use this information to make product
improvements and to suggest MongoDB products and deployment options to you.

To enable free monitoring, run the following command: db.enableFreeMonitoring()
To permanently disable this reminder, run the following command: db.disableFreeMonitoring()
---

&gt;
bye
root@node1:~# mongo --help
MongoDB shell version v4.0.6
usage: mongo [options] [db address] [file names (ending in .js)]
db address can be:
  foo                   foo database on local machine
  192.168.0.5/foo       foo database on 192.168.0.5 machine
  192.168.0.5:9999/foo  foo database on 192.168.0.5 machine on port 9999
Options:
  --shell                             run the shell after executing files
  --nodb                              don&#39;t connect to mongod on startup - no
                                      &#39;db address&#39; arg expected
  --norc                              will not run the &quot;.mongorc.js&quot; file on
                                      start up
  --quiet                             be less chatty
  --port arg                          port to connect to
  --host arg                          server to connect to
  --eval arg                          evaluate javascript
  -h [ --help ]                       show this usage information
  --version                           show version information
  --verbose                           increase verbosity
  --ipv6                              enable IPv6 support (disabled by default)
  --disableJavaScriptJIT              disable the Javascript Just In Time
                                      compiler
  --enableJavaScriptJIT               enable the Javascript Just In Time
                                      compiler
  --disableJavaScriptProtection       allow automatic JavaScript function
                                      marshalling
  --retryWrites                       automatically retry write operations upon
                                      transient network errors
  --disableImplicitSessions           do not automatically create and use
                                      implicit sessions
  --jsHeapLimitMB arg                 set the js scope&#39;s heap size limit

Authentication Options:
  -u [ --username ] arg               username for authentication
  -p [ --password ] arg               password for authentication
  --authenticationDatabase arg        user source (defaults to dbname)
  --authenticationMechanism arg       authentication mechanism
  --gssapiServiceName arg (=mongodb)  Service name to use when authenticating
                                      using GSSAPI/Kerberos
  --gssapiHostName arg                Remote host name to use for purpose of
                                      GSSAPI/Kerberos authentication

file names: a list of files to run. files have to end in .js and will exit after unless --shell is specified
root@node1:~# mongo --quiet   # 静态输出，减少打印
&gt; show dbs;
admin   0.000GB
config  0.000GB
local   0.000GB

root@node1:~# cp /etc/mongod.conf /etc/mongod.conf.ori
root@node1:~# egrep -v &#39;#|^$&#39; /etc/mongod.conf
storage:
  dbPath: /var/lib/mongodb
  journal:
    enabled: true
systemLog:
  destination: file
  logAppend: true
  path: /var/log/mongodb/mongod.log
net:
  port: 27017
  bindIp: 127.0.0.1
processManagement:
  timeZoneInfo: /usr/share/zoneinfo
root@node1:~# sed -i &#39;s/bindIp: 127.0.0.1/bindIp: 0.0.0.0/&#39; /etc/mongod.conf
root@node1:~# grep -i &#39;bindIp&#39; /etc/mongod.conf
  bindIp: 0.0.0.0
root@node1:~# systemctl restart mongod
</pre></div>
安装mingodb每个机器都要安装。其他机器安装省略。</p>
<h3 id="33">3.3 配置<a class="headerlink" href="#33" title="Permanent link">&para;</a></h3>
<h4 id="331">3.3.1 配置文件<a class="headerlink" href="#331" title="Permanent link">&para;</a></h4>
<p>配置文件最后加
<div class="codehilite"><pre><span></span>replication:
  replSetName: repset
</pre></div>
mongodb通过这个来组成集群。</p>
<div class="admonition note">
<p class="admonition-title">填坑</p>
<div class="codehilite"><pre><span></span><span class="mf">1.</span> <span class="n">mongod的配置文件</span><span class="err">，有</span><span class="n">yaml格式也有普通的</span><span class="o">=</span><span class="err">格式。</span>
<span class="mf">2.</span> <span class="n">yaml格式的参考</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">manual</span><span class="o">/</span><span class="n">reference</span><span class="o">/</span><span class="n">configuration</span><span class="o">-</span><span class="n">options</span><span class="o">/</span><span class="c1">#replication.replSetName</span>
</pre></div>

</div>
<details class="note"><summary>node1 配置文件</summary><div class="codehilite"><pre><span></span><span class="n">root</span><span class="nd">@node1</span><span class="p">:</span><span class="o">~</span><span class="c1"># egrep -v &#39;#|^$&#39; /etc/mongod.conf</span>
<span class="n">storage</span><span class="p">:</span>
  <span class="n">dbPath</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mongodb</span>
  <span class="n">journal</span><span class="p">:</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>
<span class="n">systemLog</span><span class="p">:</span>
  <span class="n">destination</span><span class="p">:</span> <span class="nb">file</span>
  <span class="n">logAppend</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">mongod</span><span class="o">.</span><span class="n">log</span>
<span class="n">net</span><span class="p">:</span>
  <span class="n">port</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="n">bindIp</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
<span class="n">processManagement</span><span class="p">:</span>
  <span class="n">timeZoneInfo</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zoneinfo</span>
<span class="n">replication</span><span class="p">:</span>
  <span class="n">replSetName</span><span class="p">:</span> <span class="n">repset</span>
</pre></div>

</details>
<details class="note"><summary>node2 配置文件</summary><div class="codehilite"><pre><span></span><span class="n">root</span><span class="nd">@node2</span><span class="p">:</span><span class="o">~</span><span class="c1"># egrep -v &#39;#|^$&#39; /etc/mongod.conf</span>
<span class="n">storage</span><span class="p">:</span>
  <span class="n">dbPath</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mongodb</span>
  <span class="n">journal</span><span class="p">:</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>
<span class="n">systemLog</span><span class="p">:</span>
  <span class="n">destination</span><span class="p">:</span> <span class="nb">file</span>
  <span class="n">logAppend</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">mongod</span><span class="o">.</span><span class="n">log</span>
<span class="n">net</span><span class="p">:</span>
  <span class="n">port</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="n">bindIp</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
<span class="n">processManagement</span><span class="p">:</span>
  <span class="n">timeZoneInfo</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zoneinfo</span>
<span class="n">replication</span><span class="p">:</span>
  <span class="n">replSetName</span><span class="p">:</span> <span class="n">repset</span>
</pre></div>

</details>
<details class="note"><summary>node3 配置文件</summary><div class="codehilite"><pre><span></span><span class="n">root</span><span class="nd">@node3</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">mongo</span><span class="o">/</span><span class="n">conf</span><span class="c1"># egrep -v &#39;#|^$&#39; /etc/mongod.conf</span>
<span class="n">storage</span><span class="p">:</span>
  <span class="n">dbPath</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mongodb</span>
  <span class="n">journal</span><span class="p">:</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>
<span class="n">systemLog</span><span class="p">:</span>
  <span class="n">destination</span><span class="p">:</span> <span class="nb">file</span>
  <span class="n">logAppend</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">mongod</span><span class="o">.</span><span class="n">log</span>
<span class="n">net</span><span class="p">:</span>
  <span class="n">port</span><span class="p">:</span> <span class="mi">27017</span>
  <span class="n">bindIp</span><span class="p">:</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span>
<span class="n">processManagement</span><span class="p">:</span>
  <span class="n">timeZoneInfo</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">zoneinfo</span>
<span class="n">replication</span><span class="p">:</span>
  <span class="n">replSetName</span><span class="p">:</span> <span class="n">repset</span>
</pre></div>

</details>
<h4 id="332">3.3.2 初始化<a class="headerlink" href="#332" title="Permanent link">&para;</a></h4>
<p>快速命令
<div class="codehilite"><pre><span></span>rs.initiate() 
rs.conf()
rs.add(&quot;node1:27017&quot;)  # 集群中添加机器
rs.add(&quot;node3:27017&quot;)
</pre></div>
详细过程</p>
<div class="codehilite"><pre><span></span>&gt; rs.initiate()
{
    &quot;info2&quot; : &quot;no configuration specified. Using a default configuration for the set&quot;,
    &quot;me&quot; : &quot;node2:27017&quot;,
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554258330, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554258330, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:SECONDARY&gt; rs.conf()
{
    &quot;_id&quot; : &quot;repset&quot;,
    &quot;version&quot; : 1,
    &quot;protocolVersion&quot; : NumberLong(1),
    &quot;writeConcernMajorityJournalDefault&quot; : true,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;host&quot; : &quot;node2:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        }
    ],
    &quot;settings&quot; : {
        &quot;chainingAllowed&quot; : true,
        &quot;heartbeatIntervalMillis&quot; : 2000,
        &quot;heartbeatTimeoutSecs&quot; : 10,
        &quot;electionTimeoutMillis&quot; : 10000,
        &quot;catchUpTimeoutMillis&quot; : -1,
        &quot;catchUpTakeoverDelayMillis&quot; : 30000,
        &quot;getLastErrorModes&quot; : {

        },
        &quot;getLastErrorDefaults&quot; : {
            &quot;w&quot; : 1,
            &quot;wtimeout&quot; : 0
        },
        &quot;replicaSetId&quot; : ObjectId(&quot;5ca419993f98997dbf343825&quot;)
    }
}
repset:PRIMARY&gt; rs.add(&quot;node1:27017&quot;)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554258349, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554258349, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.add(&quot;node3:27017&quot;)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554258369, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554258369, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;repset&quot;,
    &quot;date&quot; : ISODate(&quot;2019-04-03T02:26:16.610Z&quot;),
    &quot;myState&quot; : 1,
    &quot;term&quot; : NumberLong(1),
    &quot;syncingTo&quot; : &quot;&quot;,
    &quot;syncSourceHost&quot; : &quot;&quot;,
    &quot;syncSourceId&quot; : -1,
    &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
    &quot;optimes&quot; : {
        &quot;lastCommittedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554258369, 1),
            &quot;t&quot; : NumberLong(1)
        },
        &quot;readConcernMajorityOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554258369, 1),
            &quot;t&quot; : NumberLong(1)
        },
        &quot;appliedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554258369, 1),
            &quot;t&quot; : NumberLong(1)
        },
        &quot;durableOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554258369, 1),
            &quot;t&quot; : NumberLong(1)
        }
    },
    &quot;lastStableCheckpointTimestamp&quot; : Timestamp(1554258332, 2),
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;name&quot; : &quot;node2:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 82,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554258369, 1),
                &quot;t&quot; : NumberLong(1)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T02:26:09Z&quot;),
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;could not find member to sync from&quot;,
            &quot;electionTime&quot; : Timestamp(1554258330, 2),
            &quot;electionDate&quot; : ISODate(&quot;2019-04-03T02:25:30Z&quot;),
            &quot;configVersion&quot; : 3,
            &quot;self&quot; : true,
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;
        },
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;node1:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 26,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554258369, 1),
                &quot;t&quot; : NumberLong(1)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554258369, 1),
                &quot;t&quot; : NumberLong(1)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T02:26:09Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T02:26:09Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T02:26:15.703Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T02:26:16.227Z&quot;),
            &quot;pingMs&quot; : NumberLong(1),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 3
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;node3:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 6,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554258369, 1),
                &quot;t&quot; : NumberLong(1)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554258369, 1),
                &quot;t&quot; : NumberLong(1)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T02:26:09Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T02:26:09Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T02:26:15.704Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T02:26:16.231Z&quot;),
            &quot;pingMs&quot; : NumberLong(1),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 3
        }
    ],
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554258369, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554258369, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt;
bye
</pre></div>

<div class="admonition note">
<p class="admonition-title">解释</p>
<div class="codehilite"><pre><span></span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="err">副本集的名称</span>
<span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="err">副本集的服务器列表</span>
<span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="err">服务器的唯一</span><span class="n">ID</span>
<span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="err">服务器主机</span>
<span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="err">是优先级，默认为</span><span class="mi">1</span><span class="err">，优先级</span><span class="mi">0</span><span class="err">为被动节点，不能成为活跃节点。优先级不位</span><span class="mi">0</span><span class="err">则按照有大到小选出活跃节点。</span>
<span class="s2">&quot;arbiterOnly&quot;</span><span class="p">:</span> <span class="err">仲裁节点，只参与投票，不接收数据，也不能成为活跃节点。</span>
</pre></div>

</div>
<h4 id="333">3.3.3 其他命令<a class="headerlink" href="#333" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.
rs.add(                        rs.conf(                       rs.help(                       rs.prototype                   rs.syncFrom(
rs.addArb(                     rs.config(                     rs.initiate(                   rs.reconfig(                   rs.toLocaleString(
rs.apply(                      rs.constructor                 rs.isMaster(                   rs.remove(                     rs.toString(
rs.bind(                       rs.debug                       rs.printReplicationInfo(       rs.slaveOk(                    rs.valueOf(
rs.call(                       rs.freeze(                     rs.printSlaveReplicationInfo(  rs.status(
rs.compareOpTimes(             rs.hasOwnProperty(             rs.propertyIsEnumerable(       rs.stepDown(
repset:PRIMARY&gt; rs.help()
    rs.status()                                { replSetGetStatus : 1 } checks repl set status
    rs.initiate()                              { replSetInitiate : null } initiates set with default settings
    rs.initiate(cfg)                           { replSetInitiate : cfg } initiates set with configuration cfg
    rs.conf()                                  get the current configuration object from local.system.replset
    rs.reconfig(cfg)                           updates the configuration of a running replica set with cfg (disconnects)
    rs.add(hostportstr)                        add a new member to the set with default attributes (disconnects)
    rs.add(membercfgobj)                       add a new member to the set with extra attributes (disconnects)
    rs.addArb(hostportstr)                     add a new member which is arbiterOnly:true (disconnects)
    rs.stepDown([stepdownSecs, catchUpSecs])   step down as primary (disconnects)
    rs.syncFrom(hostportstr)                   make a secondary sync from the given member
    rs.freeze(secs)                            make a node ineligible to become primary for the time specified
    rs.remove(hostportstr)                     remove a host from the replica set (disconnects)
    rs.slaveOk()                               allow queries on secondary nodes

    rs.printReplicationInfo()                  check oplog size and time range
    rs.printSlaveReplicationInfo()             check replica set members and replication lag
    db.isMaster()                              check who is primary

    reconfiguration helpers disconnect from the database so the shell will display
    an error, even if the command succeeds.
</pre></div>

<h3 id="34">3.4 测试<a class="headerlink" href="#34" title="Permanent link">&para;</a></h3>
<h4 id="341">3.4.1 简单测试<a class="headerlink" href="#341" title="Permanent link">&para;</a></h4>
<p>修改配置文件后，重启mongo。登录测试。</p>
<p><div class="codehilite"><pre><span></span>root@node1:~# mongo --quiet
repset:SECONDARY&gt;

root@node2:~# mongo --quiet
repset:PRIMARY&gt;

root@node3:~# mongo --quiet
repset:SECONDARY&gt;
</pre></div>
可以看出node2是primary，也就是主。其他两个node1，node3是secondary也就是从。接下来测试。</p>
<h4 id="343">3.4.3 副本测试<a class="headerlink" href="#343" title="Permanent link">&para;</a></h4>
<p>主添加数据，不选择库，默认添加到test库中。</p>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; show dbs;
admin   0.000GB
config  0.000GB
local   0.000GB
test    0.000GB
repset:PRIMARY&gt; use test;
switched to db test
repset:PRIMARY&gt; for(var i=0;i&lt;10000;i++){db.test.insert({&quot;name&quot;:&quot;caimengzhi&quot;+i,&quot;age&quot;:123})}
WriteResult({ &quot;nInserted&quot; : 1 })
repset:PRIMARY&gt; show tables;
col2
test
repset:PRIMARY&gt; db.test.count()
10000
</pre></div>

<p>从查看
<div class="codehilite"><pre><span></span>repset:SECONDARY&gt; use test;
switched to db test
repset:SECONDARY&gt;  db.test.count()
2019-04-03T13:19:39.080+0800 E QUERY    [js] Error: count failed: {
    &quot;operationTime&quot; : Timestamp(1554268771, 1),
    &quot;ok&quot; : 0,
    &quot;errmsg&quot; : &quot;not master and slaveOk=false&quot;,
    &quot;code&quot; : 13435,
    &quot;codeName&quot; : &quot;NotMasterNoSlaveOk&quot;,
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554268771, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
} :
_getErrorWithCode@src/mongo/shell/utils.js:25:13
DBQuery.prototype.count@src/mongo/shell/query.js:383:11
DBCollection.prototype.count@src/mongo/shell/collection.js:1431:12
@(shell):1:1
repset:SECONDARY&gt; rs.slaveOk()
repset:SECONDARY&gt; db.test.count()
10000
</pre></div></p>
<details class="danger"><summary>注意</summary><div class="codehilite"><pre><span></span><span class="err">默认从，不能读和写的</span><span class="p">[</span><span class="n">rs</span><span class="o">.</span><span class="n">slaveOk</span><span class="p">()</span>  <span class="err">从才可以读</span><span class="p">]</span><span class="err">，否则报错如下</span><span class="p">:</span>
<span class="n">repset</span><span class="p">:</span><span class="n">SECONDARY</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">dbs</span><span class="p">;</span>
<span class="mi">2019</span><span class="o">-</span><span class="mo">04</span><span class="o">-</span><span class="mo">02</span><span class="n">T19</span><span class="p">:</span><span class="mi">46</span><span class="p">:</span><span class="mf">28.450</span><span class="o">-</span><span class="mo">0700</span> <span class="n">E</span> <span class="n">QUERY</span>    <span class="p">[</span><span class="n">js</span><span class="p">]</span> <span class="n">Error</span><span class="p">:</span> <span class="n">listDatabases</span> <span class="n">failed</span><span class="p">:{</span>
    <span class="s2">&quot;operationTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554259582</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;ok&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;errmsg&quot;</span> <span class="p">:</span> <span class="s2">&quot;not master and slaveOk=false&quot;</span><span class="p">,</span>
    <span class="s2">&quot;code&quot;</span> <span class="p">:</span> <span class="mi">13435</span><span class="p">,</span>
    <span class="s2">&quot;codeName&quot;</span> <span class="p">:</span> <span class="s2">&quot;NotMasterNoSlaveOk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;$clusterTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;clusterTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554259582</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;signature&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hash&quot;</span> <span class="p">:</span> <span class="n">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span><span class="p">),</span>
            <span class="s2">&quot;keyId&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="p">:</span>
<span class="n">_getErrorWithCode</span><span class="nd">@src</span><span class="o">/</span><span class="n">mongo</span><span class="o">/</span><span class="n">shell</span><span class="o">/</span><span class="n">utils</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">13</span>
<span class="n">Mongo</span><span class="o">.</span><span class="n">prototype</span><span class="o">.</span><span class="n">getDBs</span><span class="nd">@src</span><span class="o">/</span><span class="n">mongo</span><span class="o">/</span><span class="n">shell</span><span class="o">/</span><span class="n">mongo</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">139</span><span class="p">:</span><span class="mi">1</span>
<span class="n">shellHelper</span><span class="o">.</span><span class="n">show</span><span class="nd">@src</span><span class="o">/</span><span class="n">mongo</span><span class="o">/</span><span class="n">shell</span><span class="o">/</span><span class="n">utils</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">882</span><span class="p">:</span><span class="mi">13</span>
<span class="n">shellHelper</span><span class="nd">@src</span><span class="o">/</span><span class="n">mongo</span><span class="o">/</span><span class="n">shell</span><span class="o">/</span><span class="n">utils</span><span class="o">.</span><span class="n">js</span><span class="p">:</span><span class="mi">766</span><span class="p">:</span><span class="mi">15</span>
<span class="err">@</span><span class="p">(</span><span class="n">shellhelp2</span><span class="p">):</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span>
</pre></div>

</details>
<h4 id="343_1">3.4.3 高可用测试<a class="headerlink" href="#343_1" title="Permanent link">&para;</a></h4>
<p>关闭primary mongo</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; db.col2.find()
{ &quot;_id&quot; : ObjectId(&quot;5ca41e317b1bb7f26e3fb62b&quot;), &quot;name&quot; : &quot;caimengzhi&quot; }
repset:PRIMARY&gt;
root@node2:~# systemctl stop mongod.service
</pre></div>
查看其他的，期中node1上mongodb自动切换为primary了。node3还是SECONDARY。
<div class="codehilite"><pre><span></span>repset:SECONDARY&gt; show dbs;
admin   0.000GB
config  0.000GB
local   0.000GB
test    0.000GB
repset:PRIMARY&gt;
</pre></div>
继续测试</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; db.col2.insert({&quot;name&quot;:&quot;可可&quot;})
WriteResult({ &quot;nInserted&quot; : 1 })
repset:PRIMARY&gt; db.col2.find()
{ &quot;_id&quot; : ObjectId(&quot;5ca41e317b1bb7f26e3fb62b&quot;), &quot;name&quot; : &quot;caimengzhi&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5ca4234d03595133e357b7e7&quot;), &quot;name&quot; : &quot;可可&quot; }

repset:SECONDARY&gt; db.col2.find()
{ &quot;_id&quot; : ObjectId(&quot;5ca41e317b1bb7f26e3fb62b&quot;), &quot;name&quot; : &quot;caimengzhi&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5ca4234d03595133e357b7e7&quot;), &quot;name&quot; : &quot;可可&quot; }
</pre></div>
说明完美自动切换了。我再起起点之前的primary mongo，自动会变成secondary。</p>
<p>secondary mongo是不允许写数据的</p>
<div class="codehilite"><pre><span></span>root@node2:~# mongo --quiet
repset:SECONDARY&gt; db.col2.insert({&quot;name&quot;:&quot;数据来自secondary&quot;})
WriteCommandError({
    &quot;operationTime&quot; : Timestamp(1554262271, 1),
    &quot;ok&quot; : 0,
    &quot;errmsg&quot; : &quot;not master&quot;,
    &quot;code&quot; : 10107,
    &quot;codeName&quot; : &quot;NotMaster&quot;,
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262271, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
})
repset:SECONDARY&gt; db.col2.find()
Error: error: {
    &quot;operationTime&quot; : Timestamp(1554262281, 1),
    &quot;ok&quot; : 0,
    &quot;errmsg&quot; : &quot;not master and slaveOk=false&quot;,
    &quot;code&quot; : 13435,
    &quot;codeName&quot; : &quot;NotMasterNoSlaveOk&quot;,
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262281, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:SECONDARY&gt; rs.slaveOk()
repset:SECONDARY&gt; db.col2.find()
{ &quot;_id&quot; : ObjectId(&quot;5ca41e317b1bb7f26e3fb62b&quot;), &quot;name&quot; : &quot;caimengzhi&quot; }
{ &quot;_id&quot; : ObjectId(&quot;5ca4234d03595133e357b7e7&quot;), &quot;name&quot; : &quot;可可&quot; }
</pre></div>

<h2 id="4">4. 其他测试<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 删除<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<p><div class="codehilite"><pre><span></span>rs.remove(&#39;node2:27017&#39;)
</pre></div>
操作</p>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.remove(&#39;node2:27017&#39;)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554262658, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262658, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;repset&quot;,
    &quot;date&quot; : ISODate(&quot;2019-04-03T03:37:41.088Z&quot;),
    &quot;myState&quot; : 1,
    &quot;term&quot; : NumberLong(2),
    &quot;syncingTo&quot; : &quot;&quot;,
    &quot;syncSourceHost&quot; : &quot;&quot;,
    &quot;syncSourceId&quot; : -1,
    &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
    &quot;optimes&quot; : {
        &quot;lastCommittedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262658, 1),
            &quot;t&quot; : NumberLong(2)
        },
        &quot;readConcernMajorityOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262658, 1),
            &quot;t&quot; : NumberLong(2)
        },
        &quot;appliedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262658, 1),
            &quot;t&quot; : NumberLong(2)
        },
        &quot;durableOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262658, 1),
            &quot;t&quot; : NumberLong(2)
        }
    },
    &quot;lastStableCheckpointTimestamp&quot; : Timestamp(1554262621, 1),
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;node1:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 4382,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554262658, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T03:37:38Z&quot;),
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;electionTime&quot; : Timestamp(1554260529, 1),
            &quot;electionDate&quot; : ISODate(&quot;2019-04-03T03:02:09Z&quot;),
            &quot;configVersion&quot; : 4,
            &quot;self&quot; : true,
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;node3:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 2822,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554262658, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554262658, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T03:37:38Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T03:37:38Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T03:37:40.489Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T03:37:40.999Z&quot;),
            &quot;pingMs&quot; : NumberLong(1),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 4
        }
    ],
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554262658, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262658, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</pre></div>

<h3 id="42">4.2 添加<a class="headerlink" href="#42" title="Permanent link">&para;</a></h3>
<p>要是新的机器想添加到集群中，只有配置好配置文件，然后启动在primary mongodb上加入该机器即可。
上节吧node2剔除集群了。现在我们假设node2是新的机器。然后加入集群即可。
<div class="codehilite"><pre><span></span>rs.add(&quot;node2:27017&quot;)
</pre></div></p>
<p>操作
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.add(&quot;node2:27017&quot;)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554262759, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262759, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}

repset:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;repset&quot;,
    &quot;date&quot; : ISODate(&quot;2019-04-03T03:39:21.715Z&quot;),
    &quot;myState&quot; : 1,
    &quot;term&quot; : NumberLong(2),
    &quot;syncingTo&quot; : &quot;&quot;,
    &quot;syncSourceHost&quot; : &quot;&quot;,
    &quot;syncSourceId&quot; : -1,
    &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
    &quot;optimes&quot; : {
        &quot;lastCommittedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262751, 1),
            &quot;t&quot; : NumberLong(2)
        },
        &quot;appliedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262759, 1),
            &quot;t&quot; : NumberLong(2)
        },
        &quot;durableOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554262759, 1),
            &quot;t&quot; : NumberLong(2)
        }
    },
    &quot;lastStableCheckpointTimestamp&quot; : Timestamp(1554262741, 1),
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;node1:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 4482,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554262759, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T03:39:19Z&quot;),
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;electionTime&quot; : Timestamp(1554260529, 1),
            &quot;electionDate&quot; : ISODate(&quot;2019-04-03T03:02:09Z&quot;),
            &quot;configVersion&quot; : 5,
            &quot;self&quot; : true,
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;node3:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 2923,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554262751, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554262751, 1),
                &quot;t&quot; : NumberLong(2)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T03:39:11Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T03:39:11Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T03:39:19.762Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T03:39:21.274Z&quot;),
            &quot;pingMs&quot; : NumberLong(18),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;node1:27017&quot;,
            &quot;syncSourceHost&quot; : &quot;node1:27017&quot;,
            &quot;syncSourceId&quot; : 1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 4
        },
        {
            &quot;_id&quot; : 3,
            &quot;name&quot; : &quot;node2:27017&quot;,
            &quot;health&quot; : 0,
            &quot;state&quot; : 8,
            &quot;stateStr&quot; : &quot;(not reachable/healthy)&quot;,
            &quot;uptime&quot; : 0,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(0, 0),
                &quot;t&quot; : NumberLong(-1)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(0, 0),
                &quot;t&quot; : NumberLong(-1)
            },
            &quot;optimeDate&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T03:39:19.765Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T03:39:21.534Z&quot;),
            &quot;pingMs&quot; : NumberLong(0),
            &quot;lastHeartbeatMessage&quot; : &quot;Our replica set configuration is invalid or does not include us&quot;,
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : -1
        }
    ],
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554262759, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554262759, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</pre></div></p>
<h3 id="43">4.3 查看复制的情况<a class="headerlink" href="#43" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt;  db.printSlaveReplicationInfo()
source: node3:27017
    syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST)
    0 secs (0 hrs) behind the primary
source: node2:27017
    syncedTo: Wed Apr 03 2019 13:10:21 GMT+0800 (CST)
    0 secs (0 hrs) behind the primary
</pre></div>

<div class="admonition note">
<p class="admonition-title">解释</p>
<div class="codehilite"><pre><span></span><span class="n">source</span><span class="err">：从库的</span><span class="n">ip和端口</span><span class="err">。</span>
<span class="n">syncedTo</span><span class="err">：目前的同步情况，以及最后一次同步的时间。</span>
<span class="err">从上面可以看出，在数据库内容不变的情况下他是不同步的，数据库变动就会马上同步</span>
</pre></div>

</div>
<h3 id="44">4.4 查看副本集配置<a class="headerlink" href="#44" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.conf()
{
    &quot;_id&quot; : &quot;repset&quot;,
    &quot;version&quot; : 5,
    &quot;protocolVersion&quot; : NumberLong(1),
    &quot;writeConcernMajorityJournalDefault&quot; : true,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;host&quot; : &quot;node1:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 2,
            &quot;host&quot; : &quot;node3:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 3,
            &quot;host&quot; : &quot;node2:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        }
    ],
    &quot;settings&quot; : {
        &quot;chainingAllowed&quot; : true,
        &quot;heartbeatIntervalMillis&quot; : 2000,
        &quot;heartbeatTimeoutSecs&quot; : 10,
        &quot;electionTimeoutMillis&quot; : 10000,
        &quot;catchUpTimeoutMillis&quot; : -1,
        &quot;catchUpTakeoverDelayMillis&quot; : 30000,
        &quot;getLastErrorModes&quot; : {

        },
        &quot;getLastErrorDefaults&quot; : {
            &quot;w&quot; : 1,
            &quot;wtimeout&quot; : 0
        },
        &quot;replicaSetId&quot; : ObjectId(&quot;5ca419993f98997dbf343825&quot;)
    }
}
</pre></div>

<h3 id="45">4.5 注意<a class="headerlink" href="#45" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>所有的Secondary都宕机、或则副本集中只剩下一个节点，则该节点只能为Secondary节点，也就意味着整个集群智能进行读操作而不能进行写操作，当其他的恢复时，之前的primary节点仍然是primary节点。
当某个节点宕机后重新启动该节点会有一段的时间（时间长短视集群的数据量和宕机时间而定）导致整个集群中所有节点都成为secondary而无法进行写操作（如果应用程序没有设置相应的ReadReference也可能不能进行读取操作）。
官方推荐的最小的副本集也应该具备一个primary节点和两个secondary节点。两个节点的副本集不具备真正的故障转移能力。
</pre></div>

<h2 id="5">5. 应用<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 手动切换<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<p>手动切换Primary节点到自己给定的节点，上面已经提到过了优先集priority，因为默认的都是1，所以只需要把给定的服务器的priority加到最大即可。</p>
<details class="note"><summary>查看priority</summary><div class="codehilite"><pre><span></span><span class="n">repset</span><span class="p">:</span><span class="n">SECONDARY</span><span class="o">&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">conf</span><span class="p">()</span>
<span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="s2">&quot;repset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;protocolVersion&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;writeConcernMajorityJournalDefault&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;members&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arbiterOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;buildIndexes&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;hidden&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span> <span class="p">:</span> <span class="p">{</span>

            <span class="p">},</span>
            <span class="s2">&quot;slaveDelay&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;votes&quot;</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;node3:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arbiterOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;buildIndexes&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;hidden&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span> <span class="p">:</span> <span class="p">{</span>

            <span class="p">},</span>
            <span class="s2">&quot;slaveDelay&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;votes&quot;</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;node2:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arbiterOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;buildIndexes&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;hidden&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span> <span class="p">:</span> <span class="p">{</span>

            <span class="p">},</span>
            <span class="s2">&quot;slaveDelay&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;votes&quot;</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;settings&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;chainingAllowed&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;heartbeatIntervalMillis&quot;</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="s2">&quot;heartbeatTimeoutSecs&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;electionTimeoutMillis&quot;</span> <span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="s2">&quot;catchUpTimeoutMillis&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;catchUpTakeoverDelayMillis&quot;</span> <span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
        <span class="s2">&quot;getLastErrorModes&quot;</span> <span class="p">:</span> <span class="p">{</span>

        <span class="p">},</span>
        <span class="s2">&quot;getLastErrorDefaults&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;w&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;wtimeout&quot;</span> <span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s2">&quot;replicaSetId&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;5ca419993f98997dbf343825&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</details>
<p>先查看谁是primary</p>
<details class="note"><summary>查看谁是primary</summary><div class="codehilite"><pre><span></span><span class="n">repset</span><span class="p">:</span><span class="n">SECONDARY</span><span class="o">&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">isMaster</span><span class="p">()</span>
<span class="p">{</span>
    <span class="s2">&quot;hosts&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
        <span class="s2">&quot;node3:27017&quot;</span><span class="p">,</span>
        <span class="s2">&quot;node2:27017&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;setName&quot;</span> <span class="p">:</span> <span class="s2">&quot;repset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;setVersion&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;ismaster&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;secondary&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;primary&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
    <span class="s2">&quot;me&quot;</span> <span class="p">:</span> <span class="s2">&quot;node2:27017&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lastWrite&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;opTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554269251</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;lastWriteDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:27:31Z&quot;</span><span class="p">),</span>
        <span class="s2">&quot;majorityOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554269251</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;majorityWriteDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:27:31Z&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;maxBsonObjectSize&quot;</span> <span class="p">:</span> <span class="mi">16777216</span><span class="p">,</span>
    <span class="s2">&quot;maxMessageSizeBytes&quot;</span> <span class="p">:</span> <span class="mi">48000000</span><span class="p">,</span>
    <span class="s2">&quot;maxWriteBatchSize&quot;</span> <span class="p">:</span> <span class="mi">100000</span><span class="p">,</span>
    <span class="s2">&quot;localTime&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:27:34.165Z&quot;</span><span class="p">),</span>
    <span class="s2">&quot;logicalSessionTimeoutMinutes&quot;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;minWireVersion&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;maxWireVersion&quot;</span> <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s2">&quot;readOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;ok&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;operationTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554269251</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;$clusterTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;clusterTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554269251</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;signature&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hash&quot;</span> <span class="p">:</span> <span class="n">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span><span class="p">),</span>
            <span class="s2">&quot;keyId&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="err">可以看出</span><span class="n">node1此时为primary身份</span><span class="err">。</span>
</pre></div>

</details>
<p>此时我们让手动让node2位primary</p>
<details class="note"><summary>怎么分辨node2的是哪个</summary><div class="codehilite"><pre><span></span><span class="mf">1.</span> <span class="n">cfg</span><span class="o">.</span><span class="n">members</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">priority</span><span class="o">=</span><span class="mi">2</span> <span class="err">是修改</span><span class="n">node2的优先级是2</span><span class="p">[</span><span class="err">默认大家都是</span><span class="mi">1</span><span class="p">]</span><span class="err">，这样</span><span class="n">node2是</span><span class="o">&gt;</span><span class="mi">1</span><span class="err">的话，优先级就高，这样就重新选举后</span><span class="n">node2会是parimary</span>
<span class="mf">2.</span> <span class="err">怎么看出</span><span class="n">node2是2呢</span><span class="err">?</span>
    <span class="n">rs</span><span class="o">.</span><span class="n">status</span><span class="p">()</span> <span class="err">查看结果的时候期中</span><span class="s2">&quot;members&quot;</span> <span class="err">后面是数组，</span><span class="n">node2在第三位所以是2</span><span class="p">[</span><span class="err">下标是</span><span class="mi">0</span><span class="err">开始计算</span><span class="p">]</span>
</pre></div>

</details>
<p>操作过程</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; cfg=rs.conf()
{
    &quot;_id&quot; : &quot;repset&quot;,
    &quot;version&quot; : 5,
    &quot;protocolVersion&quot; : NumberLong(1),
    &quot;writeConcernMajorityJournalDefault&quot; : true,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;host&quot; : &quot;node1:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 2,
            &quot;host&quot; : &quot;node3:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 3,
            &quot;host&quot; : &quot;node2:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        }
    ],
    &quot;settings&quot; : {
        &quot;chainingAllowed&quot; : true,
        &quot;heartbeatIntervalMillis&quot; : 2000,
        &quot;heartbeatTimeoutSecs&quot; : 10,
        &quot;electionTimeoutMillis&quot; : 10000,
        &quot;catchUpTimeoutMillis&quot; : -1,
        &quot;catchUpTakeoverDelayMillis&quot; : 30000,
        &quot;getLastErrorModes&quot; : {

        },
        &quot;getLastErrorDefaults&quot; : {
            &quot;w&quot; : 1,
            &quot;wtimeout&quot; : 0
        },
        &quot;replicaSetId&quot; : ObjectId(&quot;5ca419993f98997dbf343825&quot;)
    }
}

repset:PRIMARY&gt; cfg.members[2].priority=2
2

repset:PRIMARY&gt; rs.reconfig(cfg)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270041, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270041, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}

repset:SECONDARY&gt; rs.isMaster()
{
    &quot;hosts&quot; : [
        &quot;node1:27017&quot;,
        &quot;node3:27017&quot;,
        &quot;node2:27017&quot;
    ],
    &quot;setName&quot; : &quot;repset&quot;,
    &quot;setVersion&quot; : 6,
    &quot;ismaster&quot; : false,
    &quot;secondary&quot; : true,
    &quot;primary&quot; : &quot;node2:27017&quot;,
    &quot;me&quot; : &quot;node1:27017&quot;,
    &quot;lastWrite&quot; : {
        &quot;opTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270083, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;lastWriteDate&quot; : ISODate(&quot;2019-04-03T05:41:23Z&quot;),
        &quot;majorityOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270083, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;majorityWriteDate&quot; : ISODate(&quot;2019-04-03T05:41:23Z&quot;)
    },
    &quot;maxBsonObjectSize&quot; : 16777216,
    &quot;maxMessageSizeBytes&quot; : 48000000,
    &quot;maxWriteBatchSize&quot; : 100000,
    &quot;localTime&quot; : ISODate(&quot;2019-04-03T05:41:31.133Z&quot;),
    &quot;logicalSessionTimeoutMinutes&quot; : 30,
    &quot;minWireVersion&quot; : 0,
    &quot;maxWireVersion&quot; : 7,
    &quot;readOnly&quot; : false,
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270083, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270083, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</pre></div>
给定的node2服务器就成为了primary节点。</p>
<h3 id="52">5.2 添加备份节点<a class="headerlink" href="#52" title="Permanent link">&para;</a></h3>
<p>hidden（成员用于支持专用功能）：这样设置后此机器在读写中都不可见，并且不会被选举为Primary，但是可以投票，一般用于备份数据。把node3节点删除，重启。再添加让其为hidden节点：</p>
<details class="note"><summary>删除node3</summary><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;repset&quot;,
    &quot;date&quot; : ISODate(&quot;2019-04-03T05:49:19.032Z&quot;),
    &quot;myState&quot; : 1,
    &quot;term&quot; : NumberLong(3),
    &quot;syncingTo&quot; : &quot;&quot;,
    &quot;syncSourceHost&quot; : &quot;&quot;,
    &quot;syncSourceId&quot; : -1,
    &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
    &quot;optimes&quot; : {
        &quot;lastCommittedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270553, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;readConcernMajorityOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270553, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;appliedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270553, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;durableOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270553, 1),
            &quot;t&quot; : NumberLong(3)
        }
    },
    &quot;lastStableCheckpointTimestamp&quot; : Timestamp(1554270513, 1),
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;node1:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 7799,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554270553, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554270553, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T05:49:13Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T05:49:13Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T05:49:17.784Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T05:49:18.505Z&quot;),
            &quot;pingMs&quot; : NumberLong(0),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceHost&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceId&quot; : 3,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 6
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;node3:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 7799,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554270553, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554270553, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T05:49:13Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T05:49:13Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T05:49:17.780Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T05:49:18.574Z&quot;),
            &quot;pingMs&quot; : NumberLong(1),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceHost&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceId&quot; : 3,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 6
        },
        {
            &quot;_id&quot; : 3,
            &quot;name&quot; : &quot;node2:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 8506,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554270553, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T05:49:13Z&quot;),
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;electionTime&quot; : Timestamp(1554270051, 1),
            &quot;electionDate&quot; : ISODate(&quot;2019-04-03T05:40:51Z&quot;),
            &quot;configVersion&quot; : 6,
            &quot;self&quot; : true,
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;
        }
    ],
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270553, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270553, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.remove(&#39;node3:27017&#39;)
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270578, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270578, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;repset&quot;,
    &quot;date&quot; : ISODate(&quot;2019-04-03T05:49:40.382Z&quot;),
    &quot;myState&quot; : 1,
    &quot;term&quot; : NumberLong(3),
    &quot;syncingTo&quot; : &quot;&quot;,
    &quot;syncSourceHost&quot; : &quot;&quot;,
    &quot;syncSourceId&quot; : -1,
    &quot;heartbeatIntervalMillis&quot; : NumberLong(2000),
    &quot;optimes&quot; : {
        &quot;lastCommittedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270578, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;readConcernMajorityOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270578, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;appliedOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270578, 1),
            &quot;t&quot; : NumberLong(3)
        },
        &quot;durableOpTime&quot; : {
            &quot;ts&quot; : Timestamp(1554270578, 1),
            &quot;t&quot; : NumberLong(3)
        }
    },
    &quot;lastStableCheckpointTimestamp&quot; : Timestamp(1554270573, 1),
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;node1:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 7820,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554270573, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDurable&quot; : {
                &quot;ts&quot; : Timestamp(1554270573, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T05:49:33Z&quot;),
            &quot;optimeDurableDate&quot; : ISODate(&quot;2019-04-03T05:49:33Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2019-04-03T05:49:38.560Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2019-04-03T05:49:38.565Z&quot;),
            &quot;pingMs&quot; : NumberLong(0),
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;,
            &quot;syncingTo&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceHost&quot; : &quot;node2:27017&quot;,
            &quot;syncSourceId&quot; : 3,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;configVersion&quot; : 6
        },
        {
            &quot;_id&quot; : 3,
            &quot;name&quot; : &quot;node2:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 8527,
            &quot;optime&quot; : {
                &quot;ts&quot; : Timestamp(1554270578, 1),
                &quot;t&quot; : NumberLong(3)
            },
            &quot;optimeDate&quot; : ISODate(&quot;2019-04-03T05:49:38Z&quot;),
            &quot;syncingTo&quot; : &quot;&quot;,
            &quot;syncSourceHost&quot; : &quot;&quot;,
            &quot;syncSourceId&quot; : -1,
            &quot;infoMessage&quot; : &quot;&quot;,
            &quot;electionTime&quot; : Timestamp(1554270051, 1),
            &quot;electionDate&quot; : ISODate(&quot;2019-04-03T05:40:51Z&quot;),
            &quot;configVersion&quot; : 7,
            &quot;self&quot; : true,
            &quot;lastHeartbeatMessage&quot; : &quot;&quot;
        }
    ],
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270578, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270578, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</pre></div>

</details>
<p>添加备用节点[hidden隐藏]</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.add({&quot;host&quot;:&quot;node3:27017&quot;,&quot;priority&quot;:0,&quot;hidden&quot;:true})
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554270639, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554270639, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
</pre></div>
查看状态</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.conf()
{
    &quot;_id&quot; : &quot;repset&quot;,
    &quot;version&quot; : 8,
    &quot;protocolVersion&quot; : NumberLong(1),
    &quot;writeConcernMajorityJournalDefault&quot; : true,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;host&quot; : &quot;node1:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 3,
            &quot;host&quot; : &quot;node2:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 2,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 4,
            &quot;host&quot; : &quot;node3:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : true,
            &quot;priority&quot; : 0,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        }
    ],
    &quot;settings&quot; : {
        &quot;chainingAllowed&quot; : true,
        &quot;heartbeatIntervalMillis&quot; : 2000,
        &quot;heartbeatTimeoutSecs&quot; : 10,
        &quot;electionTimeoutMillis&quot; : 10000,
        &quot;catchUpTimeoutMillis&quot; : -1,
        &quot;catchUpTakeoverDelayMillis&quot; : 30000,
        &quot;getLastErrorModes&quot; : {

        },
        &quot;getLastErrorDefaults&quot; : {
            &quot;w&quot; : 1,
            &quot;wtimeout&quot; : 0
        },
        &quot;replicaSetId&quot; : ObjectId(&quot;5ca419993f98997dbf343825&quot;)
    }
}
</pre></div>
测试其能否参与投票：关闭当前的Primary，查看是否自动转移Primary</p>
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; use admin
switched to db admin
repset:PRIMARY&gt; db.shutdownServer()
server should be down...
2019-04-03T13:57:22.020+0800 I NETWORK  [js] trying reconnect to 127.0.0.1:27017 failed
2019-04-03T13:57:22.601+0800 I NETWORK  [js] reconnect 127.0.0.1:27017 failed failed
2019-04-03T13:57:22.604+0800 I NETWORK  [js] trying reconnect to 127.0.0.1:27017 failed
2019-04-03T13:57:22.604+0800 I NETWORK  [js] reconnect 127.0.0.1:27017 failed failed
</pre></div>

<p>链接另一个服务器[随便哪个secondary节点]看看</p>
<details class="note"><summary>查看node1</summary><div class="codehilite"><pre><span></span><span class="n">repset</span><span class="p">:</span><span class="n">SECONDARY</span><span class="o">&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">status</span><span class="p">()</span>
<span class="p">{</span>
    <span class="s2">&quot;set&quot;</span> <span class="p">:</span> <span class="s2">&quot;repset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;date&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:43.329Z&quot;</span><span class="p">),</span>
    <span class="s2">&quot;myState&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;term&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
    <span class="s2">&quot;syncingTo&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;syncSourceHost&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;syncSourceId&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;heartbeatIntervalMillis&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">2000</span><span class="p">),</span>
    <span class="s2">&quot;optimes&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;lastCommittedOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;readConcernMajorityOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;appliedOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s2">&quot;durableOpTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;lastStableCheckpointTimestamp&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271023</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;members&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;PRIMARY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">12784</span><span class="p">,</span>
            <span class="s2">&quot;optime&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimeDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:43Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;syncingTo&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceHost&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceId&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;infoMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;electionTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271042</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s2">&quot;electionDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:22Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s2">&quot;self&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;lastHeartbeatMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;node2:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s2">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;(not reachable/healthy)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;optime&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimeDurable&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimeDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;1970-01-01T00:00:00Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;optimeDurableDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;1970-01-01T00:00:00Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeat&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:42.073Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeatRecv&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:21.280Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;pingMs&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeatMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;Error connecting to node2:27017 (192.168.178.129:27017) :: caused by :: Connection refused&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncingTo&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceHost&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceId&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;infoMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;node3:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;health&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;stateStr&quot;</span> <span class="p">:</span> <span class="s2">&quot;SECONDARY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uptime&quot;</span> <span class="p">:</span> <span class="mi">423</span><span class="p">,</span>
            <span class="s2">&quot;optime&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271053</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimeDurable&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;ts&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271053</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s2">&quot;optimeDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:33Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;optimeDurableDate&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:33Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeat&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:42.033Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeatRecv&quot;</span> <span class="p">:</span> <span class="n">ISODate</span><span class="p">(</span><span class="s2">&quot;2019-04-03T05:57:42.614Z&quot;</span><span class="p">),</span>
            <span class="s2">&quot;pingMs&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;lastHeartbeatMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncingTo&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceHost&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;syncSourceId&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;infoMessage&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;configVersion&quot;</span> <span class="p">:</span> <span class="mi">8</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;ok&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;operationTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;$clusterTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;clusterTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271063</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;signature&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hash&quot;</span> <span class="p">:</span> <span class="n">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span><span class="p">),</span>
            <span class="s2">&quot;keyId&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</details>
<p>上面说明Primary已经转移，说明hidden具有投票的权利，继续查看是否有数据复制的功能。</p>
<p>在看下是否复制</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; db.test.count()
10000
repset:PRIMARY&gt; use test
switched to db test
repset:PRIMARY&gt; for(var i=0;i&lt;90;i++){db.test.insert({&quot;name&quot;:&quot;keke&quot;+i,&quot;age&quot;:123})}
WriteResult({ &quot;nInserted&quot; : 1 })
repset:PRIMARY&gt;  db.test.count()
10090

查看
repset:SECONDARY&gt; use test;
switched to db test
repset:SECONDARY&gt; db.test.count()
10090
</pre></div>
上面说明hidden具有数据复制的功能。</p>
<h3 id="53">5.3 添加延时节点<a class="headerlink" href="#53" title="Permanent link">&para;</a></h3>
<h4 id="531">5.3.1 操作<a class="headerlink" href="#531" title="Permanent link">&para;</a></h4>
<p>Delayed（成员用于支持专用功能）：可以指定一个时间延迟从primary节点同步数据。主要用于处理误删除数据马上同步到从节点导致的不一致问题。</p>
<p>我们把node3，也就是上面的隐藏节点删除，然后再以延时节点添加进来。</p>
<details class="note"><summary>删除node3</summary><div class="codehilite"><pre><span></span><span class="n">repset</span><span class="p">:</span><span class="n">PRIMARY</span><span class="o">&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;node3:27017&#39;</span><span class="p">)</span>
<span class="p">{</span>
    <span class="s2">&quot;ok&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;operationTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271650</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;$clusterTime&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;clusterTime&quot;</span> <span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="mi">1554271650</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;signature&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;hash&quot;</span> <span class="p">:</span> <span class="n">BinData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;</span><span class="p">),</span>
            <span class="s2">&quot;keyId&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">repset</span><span class="p">:</span><span class="n">PRIMARY</span><span class="o">&gt;</span> <span class="n">rs</span><span class="o">.</span><span class="n">conf</span><span class="p">()</span>
<span class="p">{</span>
    <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="s2">&quot;repset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span> <span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s2">&quot;protocolVersion&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="s2">&quot;writeConcernMajorityJournalDefault&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;members&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;node1:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arbiterOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;buildIndexes&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;hidden&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span> <span class="p">:</span> <span class="p">{</span>

            <span class="p">},</span>
            <span class="s2">&quot;slaveDelay&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;votes&quot;</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;host&quot;</span> <span class="p">:</span> <span class="s2">&quot;node2:27017&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arbiterOnly&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;buildIndexes&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
            <span class="s2">&quot;hidden&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span> <span class="p">:</span> <span class="p">{</span>

            <span class="p">},</span>
            <span class="s2">&quot;slaveDelay&quot;</span> <span class="p">:</span> <span class="n">NumberLong</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;votes&quot;</span> <span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;settings&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;chainingAllowed&quot;</span> <span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;heartbeatIntervalMillis&quot;</span> <span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="s2">&quot;heartbeatTimeoutSecs&quot;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;electionTimeoutMillis&quot;</span> <span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
        <span class="s2">&quot;catchUpTimeoutMillis&quot;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;catchUpTakeoverDelayMillis&quot;</span> <span class="p">:</span> <span class="mi">30000</span><span class="p">,</span>
        <span class="s2">&quot;getLastErrorModes&quot;</span> <span class="p">:</span> <span class="p">{</span>

        <span class="p">},</span>
        <span class="s2">&quot;getLastErrorDefaults&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;w&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;wtimeout&quot;</span> <span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s2">&quot;replicaSetId&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;5ca419993f98997dbf343825&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</details>
<p>添加node3以延时节点方式添加到集群</p>
<p><div class="codehilite"><pre><span></span>rs.add({&quot;host&quot;:&quot;node3:27017&quot;,&quot;priority&quot;:0,&quot;hidden&quot;:false,&quot;slaveDelay&quot;:120})
</pre></div>
期中priority必须为0,否则会报错。报错如下</p>
<blockquote>
<p>"errmsg" : "priority must be 0 when slaveDelay is used"</p>
</blockquote>
<details class="note"><summary>添加延时node3节点</summary><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; rs.add({&quot;host&quot;:&quot;node3:27017&quot;,&quot;priority&quot;:0,&quot;hidden&quot;:false,&quot;slaveDelay&quot;:120})
{
    &quot;ok&quot; : 1,
    &quot;operationTime&quot; : Timestamp(1554271789, 1),
    &quot;$clusterTime&quot; : {
        &quot;clusterTime&quot; : Timestamp(1554271789, 1),
        &quot;signature&quot; : {
            &quot;hash&quot; : BinData(0,&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;),
            &quot;keyId&quot; : NumberLong(0)
        }
    }
}
repset:PRIMARY&gt; rs.conf()
{
    &quot;_id&quot; : &quot;repset&quot;,
    &quot;version&quot; : 10,
    &quot;protocolVersion&quot; : NumberLong(1),
    &quot;writeConcernMajorityJournalDefault&quot; : true,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;host&quot; : &quot;node1:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 1,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 3,
            &quot;host&quot; : &quot;node2:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 2,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(0),
            &quot;votes&quot; : 1
        },
        {
            &quot;_id&quot; : 4,
            &quot;host&quot; : &quot;node3:27017&quot;,
            &quot;arbiterOnly&quot; : false,
            &quot;buildIndexes&quot; : true,
            &quot;hidden&quot; : false,
            &quot;priority&quot; : 0,
            &quot;tags&quot; : {

            },
            &quot;slaveDelay&quot; : NumberLong(120),
            &quot;votes&quot; : 1
        }
    ],
    &quot;settings&quot; : {
        &quot;chainingAllowed&quot; : true,
        &quot;heartbeatIntervalMillis&quot; : 2000,
        &quot;heartbeatTimeoutSecs&quot; : 10,
        &quot;electionTimeoutMillis&quot; : 10000,
        &quot;catchUpTimeoutMillis&quot; : -1,
        &quot;catchUpTakeoverDelayMillis&quot; : 30000,
        &quot;getLastErrorModes&quot; : {

        },
        &quot;getLastErrorDefaults&quot; : {
            &quot;w&quot; : 1,
            &quot;wtimeout&quot; : 0
        },
        &quot;replicaSetId&quot; : ObjectId(&quot;5ca419993f98997dbf343825&quot;)
    }
}
</pre></div>

</details>
<h4 id="532">5.3.2 测试<a class="headerlink" href="#532" title="Permanent link">&para;</a></h4>
<p>首先在primary上添加数据，然后去延时节点上查看。</p>
<p>primary上查看
<div class="codehilite"><pre><span></span>repset:PRIMARY&gt; db.test.count()
11000
</pre></div>
此时立马查看secondary上信息</p>
<p><div class="codehilite"><pre><span></span>repset:SECONDARY&gt; db.test.count()
11000
</pre></div>
从上可见，secondary是primary一样数据，此时开始向primary怼数据。</p>
<p><div class="codehilite"><pre><span></span>repset:PRIMARY&gt; for(var i=0;i&lt;1000;i++){db.test.insert({&quot;name&quot;:&quot;cmz&quot;+i,&quot;age&quot;:10})}
WriteResult({ &quot;nInserted&quot; : 1 })
repset:PRIMARY&gt; db.test.count()
12000
</pre></div>
时查看没有延时节点secondary数据
<div class="codehilite"><pre><span></span>repset:SECONDARY&gt; db.test.count()
12000
</pre></div>
说明数据立马同步过来了。</p>
<p>紧接着此时立马查看延时节点的secondary数据。</p>
<p><div class="codehilite"><pre><span></span>repset:SECONDARY&gt; db.test.count()
11000
</pre></div>
没有立马同步。在等等吧，我上面配置了120秒数据才同步。时间到了再次查看延时节点。</p>
<p><div class="codehilite"><pre><span></span>repset:SECONDARY&gt; db.test.count()
12000
</pre></div>
&#160; &#160; &#160; &#160;nice，时间到了，数据过来了。上面说明delayed能够成功的把同步操作延迟120秒执行。除了上面的成员之外，</p>
<ul>
<li>Secondary-Only:不能成为primary节点，只能作为secondary副本节点，防止一些性能不高的节点成为主节点。</li>
<li>Non-Voting：没有选举权的secondary节点，纯粹的备份数据节点。</li>
</ul>
<p>具体成员信息如下：</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>成为primary</th>
<th>对客户端可见</th>
<th>参与投票</th>
<th>延迟同步</th>
<th>复制数据</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>∕</td>
<td>√</td>
</tr>
<tr>
<td>Secondary-Only</td>
<td>/</td>
<td>√</td>
<td>√</td>
<td>∕</td>
<td>√</td>
</tr>
<tr>
<td>Hidden</td>
<td>/</td>
<td>/</td>
<td>√</td>
<td>∕</td>
<td>√</td>
</tr>
<tr>
<td>Delayed</td>
<td>/</td>
<td>√</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Arbiters</td>
<td>/</td>
<td>/</td>
<td>√</td>
<td>∕</td>
<td>/</td>
</tr>
<tr>
<td>Non-Voting</td>
<td>√</td>
<td>√</td>
<td>/</td>
<td>∕</td>
<td>√</td>
</tr>
</tbody>
</table>
<h3 id="54">5.4 读写分离<a class="headerlink" href="#54" title="Permanent link">&para;</a></h3>
<p>&#160; &#160; &#160; &#160;MongoDB副本集对读写分离的支持是通过Read Preferences特性进行支持的，这个特性非常复杂和灵活。</p>
<p>&#160; &#160; &#160; &#160;应用程序驱动通过read reference来设定如何对副本集进行读取操作，默认的,客户端驱动所有的读操作都是直接访问primary节点的，从而保证了数据的严格一致性。</p>
<p>支持五种的read preference模式 <a href="https://docs.mongodb.com/manual/applications/replication/#replica-set-read-preference">官网传送门</a></p>
<div class="codehilite"><pre><span></span>primary ： 主节点，默认模式，读操作只在主节点，如果主节点不可用，报错或者抛出异常。
primaryPreferred ： 首选主节点，大多情况下读操作在主节点，如果主节点不可用，如故障转移，读操作在从节点。
secondary ：从节点，读操作只在从节点， 如果从节点不可用，报错或者抛出异常。
secondaryPreferred ： 首选从节点，大多情况下读操作在从节点，特殊情况（如单主节点架构）读操作在主节点。
nearest ： 最邻近节点，读操作在最邻近的成员，可能是主节点或者从节点，关于最邻近的成员请参考
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../mongo.monitor/" title="11. MonogoDB 监控" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                11. MonogoDB 监控
              </span>
            </div>
          </a>
        
        
          <a href="../mongo.shard_info/" title="13. MonogoDB 分片集" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                13. MonogoDB 分片集
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/caimengzhi" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.a353778b.js"></script>
      
        
        
          
          <script src="../../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../js/extra.js"></script>
      
        <script src="../../../../js/baidu-tongji.js"></script>
      
        <script src="../../../../js/webfont.js"></script>
      
        <script src="../../../../js/snap.svg-min.js"></script>
      
        <script src="../../../../js/underscore-min.js"></script>
      
        <script src="../../../../js/sequence-diagram-min.js"></script>
      
        <script src="../../../../js/uml-converter.js"></script>
      
        <script src="../../../../js/sequence-loader.js"></script>
      
    
  </body>
</html>